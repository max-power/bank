require 'spec_helper'

describe Bank::IBAN do
  before do
    @iban = Bank::IBAN.new('FR14 2004 1010 0505 0001 3M026 06')
  end

  it 'should valid from class method' do
    Bank::IBAN.valid?('FR14 2004 1010 0505 0001 3M026 06').must_equal true
  end

  it 'should load the validation rules' do
    Bank.load_specifications(:iban).wont_be :empty?
    Bank.load_specifications(:iban).must_be_kind_of Hash
  end

  it 'should return the county code' do
    @iban.country_code.must_equal 'FR'
  end

  it 'should return the check digits' do
    @iban.check_digits.must_equal '14'
  end

  it 'should return the BBAN' do
    @iban.bban.must_be_kind_of Bank::BBAN
    @iban.bban.to_s.must_equal '20041010050500013M02606'
  end

  it 'should convert to integer value' do
    @iban.to_i.must_equal 200410100505000132202606152714
  end

  it 'should convert to string' do
    @iban.to_s.must_equal 'FR1420041010050500013M02606'
  end

  it 'should convert to formatted string' do
    @iban.to_s(true).must_equal 'FR14 2004 1010 0505 0001 3M02 606'
  end

  it 'should respond_to? account_number' do
    @iban.respond_to?(:account_number).must_equal true
  end

  it 'should return account_number' do
    @iban.account_number.must_equal '0500013M026'
  end

  it 'should return bank_identifier' do
    @iban.bank_identifier.must_equal '20041'
  end

  it 'should return branch_identifier' do
    @iban.branch_identifier.must_equal '01005'
  end

  [
    'AL47212110090000000235698741',
    'AD12 00012030200359100100',
    'AT611904300234573201',
    'BE68539007547034',
    'BA391290079401028494',
    'BG80BNBG96611020345678',
    'HR1210010051863000160',
    'CY17002001280000001200527600',
    'CZ6508000000192000145399',
    'DK5000400440116243',
    'EE382200221020145685',
    'FO1464600009692713',
    'FI2112345600000785',
    'FR1420041010050500013M02606',
    'GE29NB0000000101904917',
    'DE89370400440532013000',
    'GI75NWBK000000007099453',
    'GR1601101250000000012300695',
    'GL8964710001000206',
    'HU42117730161111101800000000',
    'IS140159260076545510730339',
    'IE29AIBK93115212345678',
    'IT60X0542811101000000123456',
    'LV80BANK0000435195001',
    'LI21088100002324013AA',
    'LT121000011101001000',
    'LU280019400644750000',
    'MK07300000000042425',
    'MT84MALT011000012345MTLCAST001S',
    'MD24AG000225100013104168',
    'MC5813488000010051108001292',
    'ME25505000012345678951',
    'NL91ABNA0417164300',
    'NO9386011117947',
    'PL27114020040000300201355387',
    'PT50000201231234567890154',
    'RO49AAAA1B31007593840000',
    'SM86U0322509800000000270100',
    'RS35260005601001611379',
    'SK3112000000198742637541',
    'SI56191000000123438',
    'ES9121000418450200051332',
    'SE3550000000054910000003',
    'CH9300762011623852957',
    'UA573543470006762462054925026',
    'GB29NWBK60161331926819',
    # 'DZ4000400174401001050486',
    'AO06000600000100037131174',
    'AZ21NABZ00000000137010001944',
    'BH29BMAG1299123456BH00',
    'BJ11B00610100400271101192591',
    'BR9700360305000010009795493P1',
    'VG96VPVG0000012345678901',
    'BF1030134020015400945000643',
    'BI43201011067444',
    'CM2110003001000500000605306',
    'CV64000300004547069110176',
    'FR7630007000110009970004942',
    # 'CG5230011000202151234567890',
    'CR0515202001026284066',
    'DO28BAGR00000001212453611324',
    # 'EG1100006001880800100014553',
    # 'GA2140002000055602673300064',
    'GT82TRAJ01020000001210029690',
    'IR580540105180021273113007',
    'IL620108000000099999999',
    'CI05A00060174100178530011852',
    'KZ176010251000042993',
    'KW74NBOK0000000000001000372151',
    'LB30099900000001001925579115',
    'MG4600005030010101914016056',
    'ML03D00890170001002120000447',
    'MR1300012000010000002037372',
    'MU17BOMM0101101030300200000MUR',
    'MZ59000100000011834194157',
    'PK24SCBL0000001171495101',
    'PS92PALS000000000400123456702',
    'PT50000200000163099310355',
    'SA0380000000608010167519',
    'SN12K00100152000025690007542',
    'TN5914207207100707129648',
    'TR330006100519786457841326',
    'AE260211000000230064016'
  ].each do |code|
    describe code do
      it 'should be valid' do
        Bank::IBAN.new(code).valid?.must_equal true
      end
    end
  end
end
